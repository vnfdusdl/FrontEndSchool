<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>클로저 응용</title>
  </head>
  <body>
    <script>
      // 클로저가 안 쓰인 함수
      var arr = [];
      // i는 전역변수!
      for (var i = 0; i < 5; i++) {
        arr[i] = function () {
          return i;
          // 여기까지 돌고 i=5가 됨
        };
      }
      for (var index in arr) {
        console.log(arr[index]());
        // 이 시점에서 배열 arr의 길이만큼 0에서부터 index라는 변수에 할당(대입)한다.
        // 여기서는 배열에 총 5개가 담겨있기 때문에 0~4가 순차적으로 index에 대입될 것이다.
        //따라서 console.log(arr[1]()); console.log(arr[index](2));console.log(arr[index](3));
        //console.log(arr[index](4)); console.log(arr[index](5)); 가 출력될 것이고
        //각각의 함수 fucntion() {return i}에서는 단순하게 i를 전역변수를 참조한다.
        //그러면 i의 가장 최신값인 i=5를 참조해서, 결과적으로 i가 다섯 번 출력된다.
      }
      var arr = [];
      // i는 전역변수!
      for (var i = 0; i < 5; i++) {
        arr[i] = function () {
          return i;
          // 여기까지 돌고 i=5가 됨
        };
      }
      i = 10; //여기에 i=10를 넣어주면, 밑 반복문은 i의 가장 최신값인 i=10을 가져오게 되고 결과적으로 10이 다섯번 출력됨
      for (var index in arr) {
        console.log(arr[index]());
      }

      // 클로저가 쓰인 함수
      var arr = [];
      for (var i = 0; i < 5; i++) {
        arr[i] = (function (id) { //2.id를 인자로 받는 외부함수는 i값을 id라는 변수에 담는다
          return function () { //return값으로 내부함수
            return id; //3. 내부함수는 id의 인자, 즉 지역변수를 return값으로 내보냄. 즉, 클로져.(내부함수가 외부함수의 지역변수에 접근했으니까)
          };
        })(i); // 1. id를 인자로 가지는 함수를 즉시호출하고, 이때 매개변수 i를 function(id)가 받게 된다. 
      }
      //arr[0]=function(0){ return function(){ return 0}}
      //arr[1]=function(1){ return function(){ return 1}}
      //arr[2]=function(2){ return function(){ return 2}}
      //arr[3]=function(3){ return function(){ return 3}}
      //arr[4]=function(4){ return function(){ return 4}}
      //i=5
      for (var index in arr) { //4. arr[0]~arr[4]까지를 index에 할당함
        console.log(arr[index]()); //5.  arr[0]~arr[4]까지 담겨있는 function(id)를 호출-> 0,1,2,3,4가 return된다. 
      }
    </script>
  </body>
</html>
